echo "Installation of EDA open source tools and minimal configuration to use sky130 open PDK will begin..."

echo "You will need root permissions to perform tools installation..."

echo "Setting up directories..."

cd /
sudo mkdir edatools 
cd edatools
#mkdir tools
#cd tools
sudo mkdir opentools
cd opentools

echo "Solving dependencies..."
sudo yum update -y
sudo yum upgrade -y
sudo yum install gcc gcc-c++ autoconf automake patch patchutils indent libtool python3 cmake -y
sudo yum install mesa-libGL mesa-libGLU mesa-libGLU-devel libXp libXp-devel libXmu-devel tcl tk tcl-devel tk-devel cairo cairo-devel -y
sudo yum install graphviz libXaw-devel readline-devel flex bison -y
#yum install openmpi openmpi-devel openmpi3 openmpi-devel3 -y #use if you want multi-core support

echo "Downloading tools..."
sudo wget -O ngspice-33.tar.gz https://sourceforge.net/projects/ngspice/files/ng-spice-rework/33/ngspice-33.tar.gz/download
sudo wget -O adms-2.3.6.tar.gz https://sourceforge.net/projects/mot-adms/files/adms-source/2.3/adms-2.3.6.tar.gz/download
sudo wget http://opencircuitdesign.com/magic/archive/magic-8.3.113.tgz
sudo wget http://opencircuitdesign.com/netgen/archive/netgen-1.5.162.tgz
 
echo "Installing tools..."

echo "Installing Ngspice with ADMS and XSPICE support..."
sudo tar zxvpf adms-2.3.6.tar.gz
cd adms-2.3.6
sudo ./configure
sudo make
sudo make install
cd ..

sudo tar zxvpf ngspice-33.tar.gz
cd ngspice-33
sudo wget -O ng_adms_va.tar.gz https://sourceforge.net/projects/ngspice/files/ng-spice-rework/33/ng_adms_va.tar.gz/download
sudo tar zxvpf ng_adms_va.tar.gz
echo "#############################################"
echo "You need to perform the below command as root" #uncomment from here if you get errors with ADMS
echo "#############################################"
echo "########## copy from below ##################"
echo "./autogen.sh --adms"
echo "mkdir release"
echo "cd release"
echo "../configure --with-x --enable-xspice --disable-debug --enable-cider --with-readline=yes --enable-adms CFLAGS=-std=c99"
echo "make -j$(nproc) CFLAGS=-std=c99"
echo "make install"
echo "exit"
echo "########## to above ########################"
echo "############################################"
#echo "when back to prompt type 'exit' to come back to the installation" #until here
su #comment here and uncomment the below commands if you can perform admsXml check as sudoer
#sudo ./autogen.sh --adms
#sudo mkdir release
#cd release
#../configure --with-x --enable-xspice --enable-cider --enable-openmp --with-readlines=yes --disable-debug --enable-adms #use if you want multi-core support
#sudo ../configure --with-x --enable-xspice --disable-debug --enable-cider --with-readline=yes --enable-adms CFLAGS=-std=c99
#sudo make -j$(nproc) CFLAGS=-std=c99
#sudo make install

cd ../

echo "Installing Magic Layout..."
sudo tar zxvpf magic-8.3.113.tgz
cd magic-8.3.113
sudo ./configure
sudo make
sudo make install

cd ..

echo "Installing Netgen..."
sudo tar zxvpf netgen-1.5.162.tgz
cd netgen-1.5.162
sudo ./configure
sudo make
sudo make install

cd ..

echo "Setting up minimal workarea"
cd ~
mkdir sky130_skel
cd sky130_skel
wget https://github.com/britovski/sky130_skel/blob/main/minimal_libs.tgz
tar zxvpf minimal_libs.tgz

echo "Minimal configuration for EDA open source tools and sky130 open PDK done!"
